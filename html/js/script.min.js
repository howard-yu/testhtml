$(function(){
  $('table.sortable').tablesort();
  $('select.dropdown').dropdown();
  $('.ui.checkbox').checkbox();
  $('.qty').qty();
  $('.ui.accordion').accordion();
  $('.ui.sticky').sticky({
      context: 'body'
    });
  $("button.showModal").click(function(){
    _this = $(this);
    var modaltype = _this.attr("data-modal");
    var action = _this.attr("data-function");

  });
  if($("#msgListTable").length)
  {
    msgListTableChange();
  }
  if($("#orderPurchaseList").length)
  {
    shipOk();
  }
  if($("#proEditTable").length)
  {
    tempRow = $("#proEditTable tbody tr:eq(0)").clone();
    tempRow.find('input').each(function(){
      $(this).val("");
    })
  }
  $('#startDate').calendar({
    type: 'date',
    endCalendar: $('#endDate'),
    formatter: {
        date: function (date, settings) {
          if (!date) return '';
          var day = date.getDate();
          var month = date.getMonth() + 1;
          var year = date.getFullYear();
          return day + '/' + month + '/' + year;
        }
      }
  });
  $('#endDate').calendar({
    type: 'date',
    startCalendar: $('#startDate'),
    formatter: {
        date: function (date, settings) {
          if (!date) return '';
          var day = date.getDate();
          var month = date.getMonth() + 1;
          var year = date.getFullYear();
          return day + '/' + month + '/' + year;
        }
      }
  });
})
//切換註冊登入
function changeLogin(typ,_this){
  $("#loginTab button").removeClass('active');
  $(_this).addClass('active');
  if(typ)
  {
    $("#signUp").hide();
    $("#loginform").show();
  }
  else
  {
    $("#loginform").hide();
    $("#signUp").show();
  }
}
//綁定msgListTable變動事件
function msgListTableChange(){
  $("#msgListTable select").change(function(){
    $(this).parent().parent().find(".orderAction").removeClass("grey").addClass("green").html("<i class='minus save icon'></i>儲存編輯").attr("onclick","saveOrderEdit()");
  })
  $("#msgListTable .minus,#msgListTable .plus").click(function(){
    $(this).parent().parent().parent().find(".orderAction").removeClass("grey").addClass("green").html("<i class='minus save icon'></i>儲存編輯").attr("onclick","saveOrderEdit()");
  })
}
//綁定配貨觸發出貨按鈕
function shipOk(){
  $("#orderPurchaseList .minus").click(function(){
    $(this).parent().parent().parent().find(".shipOk").removeClass("meia").addClass("disable");
  })
  $("#orderPurchaseList .plus").click(function(){
    if($(this).prev().val() == $(this).prev().data("max"))
      $(this).parent().parent().parent().find(".shipOk").removeClass("disable").addClass("meia");
  })
}
//新增訂單
function addOrderList(){
  var nowqty = $("#addOrderList tbody tr").length+1;
  var cloneobj = $("#addOrderList tbody tr:eq(0)").clone();
  cloneobj.find("select").val("").attr("id","addOrderType"+nowqty);
  cloneobj.find("input").val(0).attr("id","addOrderQty"+nowqty);
  $("#addOrderList tbody").append(cloneobj);
  $('.qty').qty();
}
//儲存編輯加入訂單
function saveOrderEdit(){

}
//配貨modal
function purchaseEdit(oid){
  $('#PurchaseModal.ui.modal').modal('show');
}
//手動成立訂單
function orderAdd(oid){
  $('#orderAdd.ui.modal').modal('show');
}
//確認訂貨詳情
function orderCheck(oid){
  // $('.ui.mini.modal a.positive').attr("onclick","delMsg("+mid+")");
  $('#checkOrder.ui.modal').modal('show');
}

//查看訂單詳情
function orderDetail(oid){
  // $('.ui.mini.modal a.positive').attr("onclick","delMsg("+mid+")");
  $('#orderDetail.ui.modal').modal('show');
}

//輸入貨運單號
function addShipNum(oid){
  // $('.ui.mini.modal a.positive').attr("onclick","delMsg("+mid+")");
  $('#addShipNum.ui.modal').modal('show');
}
//刪除留言確認
function chkDelMsg(mid){
  $('#checkDel.ui.mini.modal a.positive').attr("onclick","delMsg("+mid+")");
  $('#checkDel.ui.mini.modal').modal('show');
}
//刪除留言
function delMsg(mid){
  $("tr[data-id="+mid+"]").remove();
}
//全選
function selectAll(ta,_this){
  ($(_this).is(":checked"))?$("input[name="+ta+"]:not(disabled)").prop("checked", true):$("input[name="+ta+"]:not(disabled)").prop("checked", false)
}
//新增規格
function addRow(){
  tempRow.clone().appendTo("#proEditTable tbody");
  $("#proEditTable tbody tr").each(function(i,el){
    $(this).attr("data-id",i);
    $(this).find('button').attr('onclick','delRow('+i+')');
  })
}
//刪除規格
function delRow(i){
  $("#proEditTable tbody tr:eq("+i+")").remove();
  $("#proEditTable tbody tr").each(function(i,el){
    $(this).attr("data-id",i);
    $(this).find('button').attr('onclick','delRow('+i+')');
  })
}
//隱藏顯示
function showHide(num,_this){
  var $ta = $(_this);
  console.log($ta.find('span').text());
  if($ta.hasClass('teal')){
    $ta.removeClass('teal').addClass('meia').find('span').text('隱藏訂單明細');
    $("#filterResulte >.item:eq("+num+") .unVisible").slideDown();
  }
  else if($ta.hasClass('meia'))
  {
    $ta.removeClass('meia').addClass('teal').find('span').text('查看訂單明細');
    $("#filterResulte >.item:eq("+num+") .unVisible").slideUp();
  }
}
//隱藏顯示出貨單
function showHide2(num,_this){
  var $ta = $(_this);
  console.log($ta.find('span').text());
  if($ta.hasClass('teal')){
    $ta.removeClass('teal').addClass('meia').find('span').text('隱藏出貨單');
    $("#filterResulte >.item:eq("+num+") .unVisible").slideDown();
  }
  else if($ta.hasClass('meia'))
  {
    $ta.removeClass('meia').addClass('teal').find('span').text('顯示出貨單');
    $("#filterResulte >.item:eq("+num+") .unVisible").slideUp();
  }
}
//數量加減
jQuery.fn.qty = function() {
   this.find("button.minus").unbind("click").bind("click",function(){
     var nowN = parseInt($(this).parent().find("input").val());
     if(nowN > 0)
     {
       $(this).parent().find("input").val(nowN-1).attr("value",nowN-1);
       if($("#totalItems").length){
          $("#totalItems").val(parseInt($("#totalItems").val())+1);
       }
     }
   })
   this.find("button.plus").unbind("click").bind("click",function(){
      var nowN = parseInt($(this).parent().find("input").val());
      var max = $(this).parent().find("input").data("max")?$(this).parent().find("input").data("max"):999;
      if(nowN < max)
      {
        if($("#totalItems").length){
          if($("#totalItems").val() != "0")
          {
            $(this).parent().find("input").val(nowN+1).attr("value",nowN+1);
            $("#totalItems").val(parseInt($("#totalItems").val())-1);
          }
        }
        else
        {
          $(this).parent().find("input").val(nowN+1).attr("value",nowN+1);
        }
        
      }
   })
 };
